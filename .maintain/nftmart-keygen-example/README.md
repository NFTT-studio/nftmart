# nftmart-keygen example

Files under this directory are generated by running the following command:

```
btwiuse@penguin:~/nftmart/.maintain$ bash nftmart-keygen 1 2                                                                                       
[INFO] 18:21:07 (main) cd /tmp/tmp.QiLOMRTcAW

[INFO] 18:21:07 (main->gen_root_and_session_keys) generating root key (root.json)
[INFO] 18:21:09 (main->gen_root_and_session_keys) generating session key (session.json)

[INFO] 18:21:12 (main->gen_stash_and_controller_keys) generating stash key for genesis node 1 (stash1.json)
[INFO] 18:21:15 (main->gen_stash_and_controller_keys) generating controller key for genesis node 1 (controller1.json)
[INFO] 18:21:19 (main->gen_stash_and_controller_keys) generating stash key for genesis node 2 (stash2.json)
[INFO] 18:21:22 (main->gen_stash_and_controller_keys) generating controller key for genesis node 2 (controller2.json)

[INFO] 18:21:25 (main->gen_inject_grandpa_and_babe_keys) generating inject grandpa key for node 1 (grandpa1.json)
[INFO] 18:21:28 (main->gen_inject_grandpa_and_babe_keys) generating inject babe key for node 1 (babe1.json)
[INFO] 18:21:31 (main->gen_inject_grandpa_and_babe_keys) generating inject grandpa key for node 2 (grandpa2.json)
[INFO] 18:21:34 (main->gen_inject_grandpa_and_babe_keys) generating inject babe key for node 2 (babe2.json)

[INFO] 18:21:37 (main->gen_inject_scripts) generating inject script for node 1 (inject1.sh)
[INFO] 18:21:37 (main->gen_inject_scripts) generating inject script for node 2 (inject2.sh)

[INFO] 18:21:37 (main->gen_node_key) generating node key for p2p node1: (node1_p2p_key, node1_p2p_peer_id)
[INFO] 18:21:40 (main->gen_node_key) generating node key for p2p node2: (node2_p2p_key, node2_p2p_peer_id)

[INFO] 18:21:43 (main->gen_rust) generating rust chain_spec.rs genesis config code snippet (chain_spec.rs)

[INFO] 18:21:43 (main->gen_summary) generating summary (summary.txt, summary.html)
```

After having these files generated, modify ./bin/node/cli/src/chain_spec.rs to match the content of `chain_spec.rs`, then recompile your node binary, copy the binary to `.maintain/docker` and build a new docker image `btwiuse/nftmart:beta` using files under the directory

```
btwiuse@penguin:~/nftmart/.maintain$ make
```

Now start the first genesis node, the --node-key flag's value is take from `node1_p2p_key` file
```
. "$(dirname "$(realpath $0)")/common/nftmart"

node1(){                                                                                                                                            
  export PORT=30333                                                                                                                                
  export WS_PORT=9944                                                                                                                               
  export RPC_PORT=9933                                                                                                                              
  nftmart \                                                                                                                                        
    -d state/node1 \                                                                                                                                
    --node-key d1383db85a2175fcd7edd04a36dbf3f2522f15cdd6992508d36ac80b31fde4e5 \                                                                   
    --port "${PORT}" \                                                                                                                             
    --ws-port "${WS_PORT}" \                                                                                                                        
    --rpc-port "${RPC_PORT}"                                                                                                                        
}

node1
```

Then start the second genesis node, for this time, --node-key flag's value is take from `node2_p2p_key` file, while the last part of the --bootnodes flag's value is taken from `node1_p2p_peer_id`
```
. "$(dirname "$(realpath $0)")/common/nftmart"

node2(){
  export PORT=30334
  export WS_PORT=9945
  export RPC_PORT=9934
  nftmart \
    -d state/node2 \
    --node-key e44deb139bcd180f2010ee3afc0678f765a3cf9ff26862330d12c5e4fb65ed2e \
    --bootnodes /ip4/127.0.0.1/tcp/30333/p2p/12D3KooWP44EhEGK9pp33nr19p3xKqUbnRWawgapeJ8Bbq3y4QmX \
    --port "${PORT}" \
    --ws-port "${WS_PORT}" \
    --rpc-port "${RPC_PORT}"
}

node2
```

TODO:
- inject keys
- restart genesis nodes
- add validator node
